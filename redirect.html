<!DOCTYPE html>
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>
<body onload="myFunction()">

<h1>Trello redirct!</h1>

<script src="https://trello.com/1/client.js?key=c64bc8f6004ebe33ff5cfbef9b380bb6"></script>

<script>
function myFunction() {
var url_string = window.location.href
var url = new URL(url_string);
var type = url.searchParams.get("type");
if(type == "alexa"){
    var state = url.searchParams.get("state");
    var name = url.searchParams.get("client_id");
    var response_type = url.searchParams.get("response_type");
    //var key = url.searchParams.get("key");
    var key = "c64bc8f6004ebe33ff5cfbef9b380bb6";
    var redirect_url =  url_string + "?redirect_url=" + url.searchParams.get("redirect_uri")+"&state="+state;
    var callback_method = "fragment";
    var scopeTo = "read,write,account";
    var expiration = "never";

    Trello.setKey(key);
    Trello.authorize(
        {
            name: "Trello Helper Extension",
            type: "redirect",
            expiration: "never",
            interactive: true,
            scope: {read: true, write: false, account: true},
            success: function () {
                // Can't do nothing, we've left the page
            },
            error: function () {
                alert("Failed to authorize with Trello.")
            }
        });

    //redirect_url = encodeURIComponent(redirect_url);
    //document.write(redirect_url);
    //window.location = "https://trello.com/1/authorize?callback_method="+callback_method+"&key="+key+"&expiration="+expiration+"&scope="+scopeTo+"&name="+name+"&redirect_url=https://www.google.com";//+redirect_url;
} else {
    
}
console.log(c);
    alert("");
}
</script>

</body>
</html>
